<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>commodity</title>
		<link rel="stylesheet" type="text/css" href="css/grzx.css"/>
		<link rel="stylesheet" href="css/commodity.css" />
		<link rel="stylesheet" href="../public/css/bootstrap.css" />
		<script type="text/javascript" src="../public/js/vue.js" ></script>
		<script type="text/javascript" src="../public/js/ajaxUtil.js" ></script>
		<script type="text/javascript" src="../public/js/jquery-1.12.4.js" ></script>
	</head>
	
	<body>
		<div class="header">
			<p>超市管理系统</p>
		</div>
		<div class="center">
			<div class="center_of_left">
				<div id="Personal_management">
					<p><a href="/zbl/supermarket_pcenter.html" >个人中心&gt;</a></p>
				</div>
				<div id="Commodity_management">
					<p><a href="#" class="nav-item">商品管理&gt;</a></p>
				</div>
				<div id="Staff_management">
					<p>	<a href="/ych/supermarket_manager.html">员工管理&gt;</a></p>
				</div>
			</div>
		
		
			<div id="center_of_right">
				<div id="head">
					<div class="head-item">
						<img src="http://localhost:8080/image/person" id="head-img"/>
						<span class="name" id="userName">名字</span>/<span class="name" id="userPosition">身份</span>
					</div>
					<div class="head-item">
						<div class="shangpingqu">商品区：</div>
						<div class="qu">
								<span value="all" id="region" style="border: 1px solid black;">全部区/瓜果区/生鲜区……</span>
							
						</div>
					</div>
					<div class="head-item">
						<div class="up">
							<button class="btn btn-info" id="c_up">上架商品</button>
						</div>
					</div>
					<div class="head-item">
						<div class="add">
							<button class="btn btn-info" id="c_in">购入商品</button>
						</div>
					</div>
				</div>
				
				<div class="content">
					<div class="content-left" id="commodity">
						
						<div class="comodity-item" v-for="item in items">
							<div style="display: flex;" @click="link(item.cnum)">
								<div>
									<img :src="`http://localhost:8080/image/commodity?cnum=${item.cnum}`"  class="comodity-img" />
								</div>
								<div>
									<div class="item-text">商品号：{{item.cnum}}</div>
									<div class="item-text">商品名：{{item.name}}</div>
									<div class="item-text">类别：{{item.sort}}</div>
									<div class="item-text">单价：{{item.price_out}}</div>
									<div class="item-text">生产日期：{{item.p_date}}</div>
									<div class="item-text">保质期至：{{item.safe_date}}</div>
								</div>
							</div>
						</div>
						
					</div>
					
					<div class="content-right">
						<div class="sum">
							<div class="">总商品量：<span id="c_count"></span></div>
						</div>
						<div class="sum">
							<div class="history">历史出库单：</div>
							<div class="history" id="history" >
								<a :href="`http://localhost:8080/sry/StockOut_details.html?num=${stock.num}`" v-for="stock in stocks">{{stock.outdate}} -> {{stock.cnum}}<br /></a>
							</div>
							<div class="history">
								<a href="http://localhost:8080/ljy/historyStockOut.html?page=1">查看更多历史出库单-></a>
							</div>
						</div>
						
					</div>
				</div>
				
			</div>
			
		</div>
		
	</body>
	
	<script type="text/javascript">
		
		var v1 = new Vue({
			el: '#commodity',
			data: {
				items: []
			},
			mounted() {
				this.getInfo();
				this.pushInfo();
			},
			methods: {
				getInfo() {
					ajax({
						method: HTTP_METHOD.GET, 
				   		url: "/commodity/commodity", 
				   		async: true, 
				   		type: HTTP_RESPONSE_TYPE.JSON, 
				   		callback: (datas) => { // 这里错了 你这里下面的 this 是 这个 ajax( 里面这个对象表示的 this ，JS 的this 初学者很容易犯错)
				   			console.log(datas)
				   			// 改用箭头函数 ，this 就会与当前环境 上下文保持一致，就是 this 指向是 Vue的实例
				   			this.items = datas
				   		}
			   		})
				},
				link(cnum) {
					window.location.href = "http://localhost:8080/sry/supermarket_deal.html?cnum="+cnum;
				},
				pushInfo() {
					document.getElementById("c_count").innerHTML = this.items.length
					
				}
			}
		})
		
		var v2 = new Vue({
			el: '#history',
			data: {
				stocks: []
			},
			mounted() {
					this.getInfo();
			},
			methods: {
				getInfo() {
					ajax({
						method: HTTP_METHOD.GET, 
				   		url: "/commodity/initStockOut", 
				   		async: true, 
				   		type: HTTP_RESPONSE_TYPE.JSON, 
				   		callback: (datas) => { // 这里错了 你这里下面的 this 是 这个 ajax( 里面这个对象表示的 this ，JS 的this 初学者很容易犯错)
				   			// 改用箭头函数 ，this 就会与当前环境 上下文保持一致，就是 this 指向是 Vue的实例
				   			this.stocks = datas
				   		}
			   		})
				}
			}
		})
		
		
		window.onload = function() {
			
			ajax({
				method: HTTP_METHOD.GET, 
		   		url: "/commodity/userName", 
		   		async: true, 
		   		type: HTTP_RESPONSE_TYPE.TEXT, 
		   		callback: (data) => { 
		   			if (data != "") {
		   				document.getElementById("userName").innerHTML = data;
		   			}
		   		}
	   		})
			
			ajax({
				method: HTTP_METHOD.GET, 
		   		url: "/commodity/userPosition", 
		   		async: true, 
		   		type: HTTP_RESPONSE_TYPE.TEXT, 
		   		callback: (data) => { 
		   			if (data != "") {
		   				document.getElementById("userPosition").innerHTML = data;
		   			}
		   		}
	   		})
			
			ajax({
				method: HTTP_METHOD.GET, 
		   		url: "/commodity/region", 
		   		async: true, 
		   		type: HTTP_RESPONSE_TYPE.TEXT, 
		   		callback: (data) => { 
		   			if (data == "") {
		   				document.getElementById("region").innerHTML = "全部区";
		   			} else {
		   				document.getElementById("region").innerHTML = data;
		   			}
		   		}
	   		})
		}

		document.getElementById("c_up").onclick = function() {
			window.location.href = "http://localhost:8080/zbl/supermarket_spgl_add.html";
		}
		
		document.getElementById("c_in").onclick = function() {
			window.location.href = "http://localhost:8080/lh/addcommodity.html";
		}
		
		
	</script>
	
</html>
